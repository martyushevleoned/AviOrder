# AviOrder
Сервис компании AviUp для продвижения объявлений на Авито.

---
## Сценарий использования сервиса
### Типы пользователей
1. Клиент имеет возможность:
    * Самостоятельно разобраться в сервисе
    * Зарегистрироваться / авторизоваться
    * Создать новый заказ
    * Просматривать свои заказы в личном кабинете
    * Оплачивать заказы
2. Работник может:
    * Осуществлять поиск по клиентам и заказам
    * просматривать профили пользователей и их заказы
3. Админ может:
    * Просматривать статистику использования сервиса
### Страницы
1. Домашняя страница
2. Страница авторизации / регистрации
3. Личный кабинет клиента
4. Страница редактирования заказа
5. Страница для взаимодействия Работяги с клиентом
6. Страница просмотра статистики

---
## Первоначальная настройка
1. Настроить [SSH](readme/ssh.md)
    * Сгенерировать ключи и отправить публичный
    * Изменить порт подключения по SSH
2. Настроить [Ansible](readme/ansible.md)
   * Изменить соответствующие поля в [hosts.yml](ansible/hosts.yml)
   * Проверить доступность локального устройства и сервера
3. Настроить [Docker](readme/docker.md)
   * Установить на Linux можно при помощи Ansible
   * Указать параметры для разработки в [dev.env](docker/dev.env) (его можно указать в конфигурации запуска)
   * Указать параметры для развёртывания в [prod.env](docker/prod.env) 
4. Настроить HTTPS (для развёртывания)
   * [Гайд по генерированию keystore.p12](https://habr.com/ru/articles/812257/)
   * Файл [keystore.p12](src/main/resources/keystore.p12) следует разместить в [resources](src/main/resources)
   * Указать пароль от keystore.p12 и указать порт 443 в [prod.env](docker/prod.env)
   * При использовании HTTP указать порт 80 и убрать строку ``spring_profiles_active=prod`` в [prod.env](docker/prod.env)
5. Настроить [Межсетевой экран](readme/ufw.md) (для развёртывания)
   * Включить межсетевой экран
   * Открыть порт SSH
   * Открыть порт приложения
   * Открыть порт БД

---
## Разработка
### Посмотреть список образов и контейнеров
```shell
ansible-playbook ansible/local/docker_info.yml
```
### Пересоздать контейнер БД
```shell
ansible-playbook ansible/local/recreate_db_container.yml
```
### Собрать образ приложения
```shell
ansible-playbook ansible/local/build_app_image.yml
```
### Пересоздать контейнер приложения
```shell
ansible-playbook ansible/local/recreate_app_container.yml
```
### Запустить приложение и БД используя docker compose
```shell
ansible-playbook ansible/local/deploy.yml
```
### Удалить все контейнеры
```shell
ansible-playbook ansible/local/drop_all_containers.yml
```
### Удалить все образы
```shell
ansible-playbook ansible/local/drop_all_images.yml
```

## Развёртывание на сервере на сервере
### Посмотреть список образов и контейнеров
```shell
ansible-playbook ansible/server/docker_info.yml
```
### Запустить приложение и БД
```
ansible-playbook ansible/server/deploy.yml 
```
### Обновить приложение
```
ansible-playbook ansible/server/update.yml
```
### Удалить образы и контейнеры
```
ansible-playbook ansible/server/drop_all.yml
```

---
## Задачи
### Глобальные задачи
* Изменить Сущности и перекроить приложение
* Дизайн
* Функционал
* Создание резервной копии БД и восстановление данных из дампа
* Логирование
### Задачи требующие доработки
* javadoc
* тесты
* формат даты при экспорте в .xlsx
* валидация данных в формах на стороне клиента и сервера
* фрагменты thymeleaf
* перенаправление с 80 порта на 443
### Активные задачи
* Разобраться откуда лишние образы на сервере